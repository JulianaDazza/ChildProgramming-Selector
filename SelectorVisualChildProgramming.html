<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChildProgramming - Selector Visual de Procesos</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; background: #f9fafb; color: #111827; margin: 0; }
    .container { max-width: 1100px; margin: 28px auto; padding: 20px; }
    .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 16px; }
    h1 { font-size: 22px; margin: 0 0 6px 0; }
    select, button { padding: 8px 10px; border-radius: 8px; border: 1px solid #e5e7eb; font-size: 14px; background: white; }
    label { font-size: 14px; }
    .flex { display: flex; flex-wrap: wrap; align-items: center; gap: 12px; }
    .checkboxes { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
    canvas { margin-top: 20px; max-height: 480px; }
    .legend { margin-top: 12px; font-size: 13px; }
    .legend span { display: inline-flex; align-items: center; gap: 6px; margin-right: 12px; }
    .dot { width: 12px; height: 12px; border-radius: 50%; }
    #caseDescription { margin-top: 12px; padding: 12px 14px; background: #f3f4f6; border-radius: 8px; font-size: 14px; display: none; line-height: 1.5; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Selección Visual de Procesos — ChildProgramming</h1>
      <p>Selecciona uno o varios procesos y un caso para analizar visualmente cómo las variables contextuales del aula se relacionan con los procesos de la familia <strong>ChildProgramming</strong>.</p>
    </div>

    <div class="card">
      <div class="flex">
        <div>
          <label><strong>Seleccionar caso:</strong></label>
          <select id="caseSelect">
            <option value="none">-- Ninguno --</option>

            <option value="case1">Caso 1</option>
            <option value="case2">Caso 2</option>
            <option value="case3">Caso 3</option>
            <option value="case4">Caso 4</option>
            <option value="case5">Caso 5</option>
            <option value="case6">Caso 6</option>
            <option value="case7">Caso 7</option>
            <option value="case8">Caso 8</option>
            <option value="case9">Caso 9</option>
            <option value="case10">Caso 10</option>
          </select>
        </div>
        <div><button id="resetBtn">Resetear</button></div>
      </div>

      <div id="caseDescription"></div>

      <div style="margin-top:16px;">
        <label><strong>Seleccionar procesos ChildProgramming a visualizar:</strong></label>
        <div class="checkboxes">
          <label><input type="checkbox" class="proc-toggle" value="Basico"> Básico</label>
          <label><input type="checkbox" class="proc-toggle" value="Gamificacion"> Gamificado</label>
          <label><input type="checkbox" class="proc-toggle" value="Collaboration"> Colaborativo</label>
          <label><input type="checkbox" class="proc-toggle" value="Memoria"> Memoria Transactiva</label>
          <label><input type="checkbox" class="proc-toggle" value="Gender"> Género</label>
          <label><input type="checkbox" class="proc-toggle" value="Abstraction"> Abstracción</label>
          <label><input type="checkbox" class="proc-toggle" value="Debugging"> Debugging</label>
        </div>
      </div>

      <canvas id="barChart"></canvas>
      <div class="legend" id="legend"></div>
    </div>
  </div>

  <script>
    /* ────────────────────────────────────────────────
       Variables (10)
    ──────────────────────────────────────────────── */
    const labels = [
      "Acceso a tecnología",
      "Materiales no tecnológicos",
      "Docente conoce de PC",
      "Docente conoce de programación",
      "Pedagogía activa del docente",
      "Estudiantes conocen PC/Programación",
      "Docente enfatiza colaboración",
      "Equidad de participación (género)",
      "Integración curricular del PC",
      "Integración habilidades PC"
    ];

    /* ────────────────────────────────────────────────
       Perfiles de procesos (rangos min–max)
    ──────────────────────────────────────────────── */
    const procesos = {
      "Basico": {
        min: [  2,  1,  1,  1,  3,  0,  0,  2,  0,  0],
        max: [3.9,2.9,1.9,2.9,  5,  5,3.9,  5, 5,2.9]
      },

      "Gamificacion": {
        min: [  2,  3,  0,  1,  3,  1,  0,  0,  0,  0],
        max: [3.9,  5,  5,  5,  5,  5,2.9,1.9,1.9,2.9]
      },

      "Collaboration": {
        min: [  1,  2,  0,  1,  3,  0,  4,  0,  0,  0],
        max: [  5,  5,  5,  5,  5,  5,  5,1.9,1.9,2.9]
      },

      "Memoria": {
        min: [  1,  2,  2,  2,  3,  1,  3,  0,  1,  2],
        max: [  5,  5,  5,  5,  5,  5,  5,1.9,3.9,  5]
      },

      "Gender": {
        min: [  1,  1,  1,  1,  3,  1,  2,  3,  1,  1],
        max: [  5,3.9,  5,  5,  5,  5,  5,  5,3.9,3.9]
      },
      "Abstraction": {
        min: [  1,  1,  3,  3,  2,  0,  0,  0,  2,  4],
        max: [  5,3.9,  5,  5,  5,2.9,1.9,1.9,  5,  5]
      },
      "Debugging": {
        min: [  1,  1,  2,  4,  1,  0,  0,  0,  1,  3],
        max: [  5,3.9,  5,  5,3.9,0.9,1.9,1.9,  5,  5]
      }
    };

    /* ────────────────────────────────────────────────
       Casos (10 valores)
    ──────────────────────────────────────────────── */
    const casos = {
      // -------------------------------------------------------------
      // 1. PERFIL LÚDICO Y SENCILLO
      // -------------------------------------------------------------
      "case1": {
        name: "Caso 1 - Aula de exploración inicial",
        desc: `<p>Niños pequeños que disfrutan actividades cortas, simples y muy guiadas. El ambiente es tranquilo y las tareas buscan mantener la participación sin exigir estructuras complejas.</p>`,
        data: [2.5, 1.5, 1.5, 1.5, 3.5, 0.5, 0.5, 2.5, 0.5, 0.5]
      },

      // -------------------------------------------------------------
      // 2. AULA CON ALTO ORDEN Y RUTINAS ESTABLES
      // -------------------------------------------------------------
      "case2": {
        name: "Caso 2 - Aula con actividades muy organizadas",
        desc: `<p>Los niños trabajan siguiendo pasos claros y repetitivos. Se usan secuencias de tareas, pequeños retos y momentos frecuentes de retroalimentación para mantener la atención.</p>`,
        data: [3.5, 4.5, 1.5, 2.5, 4.5, 3.5, 1.5, 1.5, 1.5, 2.5]
      },

      // -------------------------------------------------------------
      // 3. AULA QUE FAVORECE EL TRABAJO ENTRE PARES
      // -------------------------------------------------------------
      "case3": {
        name: "Caso 3 - Aula con interacción guiada entre niños",
        desc: `<p>El docente promueve actividades donde los niños se ayudan entre sí. Se usan ejemplos visuales, pequeñas dinámicas en parejas y espacios de conversación estructurada.</p>`,
        data: [2.5, 3.5, 1.5, 2.5, 4.5, 2.5, 4.5, 1.5, 1.5, 2.5]
      },

      // -------------------------------------------------------------
      // 4. AULA CON ROLES Y TAREAS DIFERENCIADAS
      // -------------------------------------------------------------
      "case4": {
        name: "Caso 4 - Aula con funciones repartidas",
        desc: `<p>Los niños asumen roles simples (quien observa, quien cuenta, quien dibuja, quien registra). El avance del grupo depende de que cada rol aporte al resultado.</p>`,
        data: [2.5, 3.5, 3.5, 3.5, 4.5, 2.5, 4.5, 1.5, 3.5, 4.5]
      },

      // -------------------------------------------------------------
      // 5. AULA QUE CUIDA LA PARTICIPACIÓN DE TODOS
      // -------------------------------------------------------------
      "case5": {
        name: "Caso 5 - Aula con atención a la participación equitativa",
        desc: `<p>El docente se asegura de que todos los niños puedan intervenir. Se cuida el lenguaje, se fomenta el respeto y se diseñan actividades donde nadie queda por fuera.</p>`,
        data: [2.5, 2.5, 2.5, 2.5, 4.5, 2.5, 3.5, 4.5, 2.5, 2.5]
      },

      // -------------------------------------------------------------
      // 6. AULA QUE ENFATIZA EL ORDEN Y LA ORGANIZACIÓN
      // -------------------------------------------------------------
      "case6": {
        name: "Caso 6 - Aula que trabaja patrones y organización",
        desc: `<p>Los niños aprenden ordenando ideas antes de actuar: clasifican objetos, buscan similitudes, dividen tareas en partes y explican cómo resolverán una actividad.</p>`,
        data: [2.5, 2.5, 4.5, 4.5, 3.5, 1.5, 1.5, 0.5, 3.5, 4.5]
      },

      // -------------------------------------------------------------
      // 7. AULA QUE TRABAJA A PARTIR DE ERRORES SIMPLES
      // -------------------------------------------------------------
      "case7": {
        name: "Caso 7 - Aula orientada al análisis de ejemplos",
        desc: `<p>Los niños observan pequeños errores en ejemplos sencillos, comentan qué podría mejorarse y prueban alternativas. Esto ayuda a que reflexionen antes de actuar.</p>`,
        data: [2.5, 2.5, 2.5, 4.5, 2.5, 0.5, 1.5, 1.5, 3.5, 3.5]
      },

      // -------------------------------------------------------------
      // 8. AULA CON MEZCLA GENERAL DE ESTILOS
      // -------------------------------------------------------------
      "case8": {
        name: "Caso 8 - Aula con actividades variadas",
        desc: `<p>Incluye momentos de juego, pequeñas tareas en pareja y algunas funciones diferenciadas. El grupo prueba distintas maneras de trabajar sin seguir un estilo dominante.</p>`,
        data: [2.5, 3.5, 2.5, 2.5, 4.5, 1.5, 2.5, 2.5, 2.5, 2.5]
      },

      // -------------------------------------------------------------
      // 9. AULA FLEXIBLE Y EXPERIMENTAL
      // -------------------------------------------------------------
      "case9": {
        name: "Caso 9 - Aula de exploración abierta",
        desc: `<p>Los niños experimentan con distintas actividades: juegos, pequeños retos, ejercicios de observación e incluso tareas sin un camino fijo de resolución.</p>`,
        data: [2.5, 2.5, 2.5, 3.5, 3.5, 1.5, 2.5, 1.5, 3.5, 3.5]
      },

      // -------------------------------------------------------------
      // 10. AULA BALANCEADA EN MÚLTIPLES DIMENSIONES
      // -------------------------------------------------------------
      "case10": {
        name: "Caso 10 - Aula con actividades multidimensionales",
        desc: `<p>El grupo combina juegos guiados, organización previa, pequeños roles y actividades de reflexión. Todas las dimensiones se trabajan a un nivel moderado.</p>`,
        data: [2.5, 3.5, 3.5, 3.5, 4.5, 1.5, 2.5, 3.5, 2.5, 3.5]
      }
    };


    /* ────────────────────────────────────────────────
       Colores
    ──────────────────────────────────────────────── */
    const colors = {
      "Basico": "#3b82f6",
      "Gamificacion": "#22c55e",
      "Collaboration": "#f59e0b",
      "Memoria": "#ef4444",
      "Gender": "#a855f7",
      "Abstraction": "#eab308",
      "Debugging": "#ec4899",
      "Caso": "#111827"
    };



    /* ────────────────────────────────────────────────
       Plugin: dibuja bandas horizontales (una por cada nivel)
       ──────────────────────────────────────────────── */
    const horizontalBands = {
      id: 'horizontalBands',
      beforeDraw(chart, args, options) {
        const {ctx, chartArea, scales} = chart;
        const yScale = scales.y;
        if (!yScale) return;

        // Niveles 0..4 (5 bandas). Usamos los colores suaves para alternar.
        const bandColors = options.colors || ['rgba(0,0,0,0.04)','rgba(0,0,0,0.01)'];
        ctx.save();
        ctx.globalCompositeOperation = 'destination-over';

        // calculamos pixel para cada valor entero 0..4, y el pixel inferior (5)
        const topPixel = yScale.getPixelForValue(4);   // valor 4 en pixel (arriba)
        const bottomPixel = yScale.getPixelForValue(0); // valor 0 (abajo)

        // aseguramos que obtenemos los 6 limites (0..5) — para cerrar la última banda
        const pixels = [];
        for (let v = 0; v <= 5; v++) {
          // para v=5 usamos getPixelForValue(4) y ajustamos extragrado hacia arriba/bajo
          const val = Math.min(4, Math.max(0, v)); // limitar
          pixels.push(yScale.getPixelForValue(val));
        }

        // Si los pixels están invertidos (depende de orientation), normalizamos
        // mejor calculamos para cada banda: from value = i to to value = i+1
        for (let i = 0; i < 5; i++) {
          const y1 = yScale.getPixelForValue(i + 1);
          const y0 = yScale.getPixelForValue(i);
          // rect top = min(y0,y1), height = abs(y1 - y0)
          const top = Math.min(y0, y1);
          const height = Math.abs(y1 - y0);
          ctx.fillStyle = bandColors[i % bandColors.length];
          ctx.fillRect(chartArea.left, top, chartArea.right - chartArea.left, height);
        }

        ctx.restore();
      }
    };

    /* ────────────────────────────────────────────────
       Configuración Chart.js
    ──────────────────────────────────────────────── */
    const ctx = document.getElementById('barChart').getContext('2d');

    // dataset para el caso (línea)
    const casoDataset = {
      label: "Caso",
      data: [],
      type: 'line',
      borderColor: colors["Caso"],
      borderWidth: 3,
      pointBackgroundColor: colors["Caso"],
      pointRadius: 6,
      fill: false,
      hidden: true,
      yAxisID: 'y'
    };

    // registramos el plugin localmente en el chart config
    Chart.register(horizontalBands);

    function nivelTexto(valor) {
      if (valor >= 0 && valor < 1) return "Muy bajo";
      if (valor >= 1 && valor < 2) return "Bajo";
      if (valor >= 2 && valor < 3) return "Medio";
      if (valor >= 3 && valor < 4) return "Alto";
      if (valor >= 4 && valor <= 5) return "Muy alto";
      return "";
    }

    const chart = new Chart(ctx, {
      type: 'bar',
      data: { labels, datasets: [casoDataset] },
      options: {
        responsive: true,
        plugins: {
          horizontalBands: { colors: ['rgba(16,24,40,0.03)','rgba(16,24,40,0.01)'] },
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                const ds = context.dataset;
                if (ds.custom && ds.custom.isMin) return null;
                const proc = ds.label;
                const idx = context.dataIndex;
                const minDs = chart.data.datasets.find(d => d.label === proc + "_min");
                const minVal = minDs ? minDs.data[idx] : 0;
                const maxVal = minVal + ds.data[idx];
                /*const names = ["Muy bajo","Bajo","Medio","Alto","Muy alto"];
                return `${proc}: ${minVal} → ${maxVal} (${names[minVal]} → ${names[maxVal]})`;*/
                return `${proc}: (${nivelTexto(minVal)} → ${nivelTexto(maxVal)})`;
              }
            }
          }
        },
        scales: {
          y: {
            min: 0,
            max: 5,
            beginAtZero: true,
            offset: false,

            // Ocultamos las líneas horizontales
            grid: {
              display: false,
            },

            // Etiquetas centradas en 0.5, 1.5, 2.5, 3.5, 4.5
            ticks: {
              stepSize: 0.5,
              callback: function(value) {
                const labels = {
                  0.5: "Muy bajo",
                  1.5: "Bajo",
                  2.5: "Medio",
                  3.5: "Alto",
                  4.5: "Muy alto"
                };
                return labels[value] || ""; // Solo mostrar en los puntos centrales
              }
            },

            title: { 
              display: true, 
              text: "Nivel" 
            }
          },
          x: {
            title: { 
              display: true, 
              text: "Variables Contextuales" 
            }
          }
        }
      }
    });

    /* ────────────────────────────────────────────────
       Leyenda dinámica: solo lista procesos (no los min)
    ──────────────────────────────────────────────── */
    const legendDiv = document.getElementById('legend');
    function updateLegend() {
      legendDiv.innerHTML = '';
      const seen = new Set();
      chart.data.datasets.forEach(ds => {
        if (!ds || !ds.label) return;
        if (ds.label.endsWith('_min')) return;
        if (ds.label === 'Caso') return;
        if (seen.has(ds.label)) return;
        seen.add(ds.label);
        const color = ds.borderColor || ds.backgroundColor || "#000";
        legendDiv.innerHTML += `<span><span class="dot" style="background:${color}"></span>${ds.label}</span>`;
      });
    }

    /* ────────────────────────────────────────────────
       Funciones para agregar/remover procesos como bloques
       (usa min/max; si max-min==0 pinta 1 para que se vea)
    ──────────────────────────────────────────────── */
    function addProcessAsRange(procKey) {
      if (chart.data.datasets.some(d => d.label === procKey && !d.label.endsWith('_min'))) return;

      const p = procesos[procKey];
      if (!p) return;
      const min = p.min;
      const max = p.max;
      const range = min.map((m, i) => {
        //const r = max[i] - m;
        //const r = (max[i] - m) + 1; // ahora abarca ambos bloques
        //return r === 0 ? 1 : r;
        // max-min = cantidad real
        let r = max[i] - m;
        // Si min==max debe ocupar EXACTAMENTE 1 bloque visual
        if (r === 0) r = 1;

        return r;
      });

      const minDs = {
        label: procKey + "_min",
        data: min.slice(),
        backgroundColor: 'rgba(0,0,0,0)',
        borderWidth: 0,
        stack: procKey,
        order: 0,
        custom: { isMin: true }
      };

      const rangeDs = {
        label: procKey,
        data: range.slice(),
        backgroundColor: colors[procKey] + "66",
        borderColor: colors[procKey],
        borderWidth: 1,
        stack: procKey,
        order: 1,
        custom: { isMin: false }
      };

      chart.data.datasets.push(minDs);
      chart.data.datasets.push(rangeDs);
    }

    function removeProcessRange(procKey) {
      chart.data.datasets = chart.data.datasets.filter(d => !(d.label === procKey || d.label === procKey + "_min"));
    }

    /* ────────────────────────────────────────────────
       Control de checkboxes de procesos
    ──────────────────────────────────────────────── */
    document.querySelectorAll('.proc-toggle').forEach(cb => {
      cb.addEventListener('change', ()=>{
        const proc = cb.value;
        if (cb.checked) addProcessAsRange(proc); else removeProcessRange(proc);
        chart.update(); updateLegend();
      });
    });

    /* ────────────────────────────────────────────────
       Selección de caso (mantiene la línea)
    ──────────────────────────────────────────────── */
    const caseSelect = document.getElementById('caseSelect');
    const caseDescription = document.getElementById('caseDescription');

    caseSelect.addEventListener('change', e=>{
      const val = e.target.value;
      const dsLinea = chart.data.datasets.find(d => d.label === "Caso");
      if (!dsLinea) return;
      if (val === 'none') {
        dsLinea.hidden = true;
        dsLinea.data = [];
        caseDescription.style.display = 'none';
      } else {
        const caso = casos[val];
        dsLinea.data = caso.data.slice();
        dsLinea.hidden = false;
        caseDescription.style.display = 'block';
        caseDescription.innerHTML = `<strong>${caso.name}</strong>${caso.desc}`;
      }
      chart.update(); updateLegend();
    });

    /* ────────────────────────────────────────────────
       Reset
    ──────────────────────────────────────────────── */
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      caseSelect.value = "none";
      caseDescription.style.display = 'none';
      chart.data.datasets = [chart.data.datasets.find(d => d.label === 'Caso')];
      document.querySelectorAll('.proc-toggle').forEach(cb=>cb.checked=false);
      const dsLinea = chart.data.datasets.find(d => d.label === "Caso");
      if (dsLinea) { dsLinea.hidden = true; dsLinea.data = []; }
      chart.update(); updateLegend();
    });

    // inicializar leyenda vacía
    updateLegend();
  </script>
</body>
</html>
